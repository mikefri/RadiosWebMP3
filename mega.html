<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lecteur audio MEGA</title>
</head>
<body>
  <h1>Lecteur audio depuis MEGA</h1>
  
  <button onclick="loginToMega()">Se connecter à MEGA</button>
  <div id="audio-list"></div>

  <!-- Charger le SDK MEGA -->
  <script src="https://unpkg.com/megajs@1.2.0/dist/main.browser-umd.js"></script>

  <script>
    let megaClient;

    // Fonction pour vérifier si le SDK MEGA est chargé
    function loadMegaSDK() {
      if (typeof mega === 'undefined') {
        console.error("Le SDK MEGA n'a pas été chargé correctement.");
      } else {
        console.log("SDK MEGA chargé avec succès.");
      }
    }

    // Fonction pour se connecter à MEGA
    function loginToMega() {
      if (typeof mega === 'undefined') {
        console.error("Le SDK MEGA n'est pas disponible.");
        return;
      }

      megaClient = mega();

      // Remplacez 'votre_email' et 'votre_mot_de_passe' par vos identifiants MEGA
      megaClient.login('mikefri58@gmail.com', 'Fm01031985@', function(err) {
        if (err) {
          console.error('Erreur de connexion:', err);
        } else {
          console.log('Connexion réussie!');
          listAudioFiles();
        }
      });
    }

    // Fonction pour lister les fichiers audio depuis MEGA
    function listAudioFiles() {
      // Lien vers le dossier MEGA, assurez-vous de le remplacer par le bon lien ou ID du dossier
      const folderLink = 'CNdw0RQY#lmoLlrBYvpnkehG9RPBK7w';  // Remplacez par l'ID du dossier MEGA

      megaClient.readdir(folderLink, function(err, files) {
        const audioListContainer = document.getElementById('audio-list');
        
        // Gestion des erreurs lors de la lecture du dossier
        if (err) {
          console.error('Erreur lors de la lecture du dossier:', err);
          audioListContainer.innerHTML = 'Erreur de récupération des fichiers.';
          return;
        }

        // Si des fichiers sont trouvés, on les affiche
        if (files.length > 0) {
          files.forEach((file) => {
            if (file.name.endsWith('.mp3') || file.name.endsWith('.wav') || file.name.endsWith('.ogg')) {
              const fileDiv = document.createElement('div');
              fileDiv.innerHTML = `
                <h3>${file.name}</h3>
                <audio controls>
                  <source src="${file.url}" type="${file.mime}">
                  Votre navigateur ne supporte pas l'audio.
                </audio>
              `;
              audioListContainer.appendChild(fileDiv);
            }
          });
        } else {
          audioListContainer.innerHTML = 'Aucun fichier audio trouvé dans ce dossier.';
        }
      });
    }

    // Charger le SDK au démarrage
    loadMegaSDK();
  </script>
</body>
</html>
