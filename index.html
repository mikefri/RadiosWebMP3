<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Lecteur audio depuis Google Drives</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <h1>Lecteur audio depuis Google Drives</h1>
  <div id="g_id_onload"
       data-client_id="702949477364-khje9k7kp6o2maappfucllp3u6va77vt.apps.googleusercontent.com" 
       data-callback="handleCredentialResponse" 
       data-auto_prompt="false">
  </div>
  
  <div id="audio-list"></div>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = '702949477364-khje9k7kp6o2maappfucllp3u6va77vt.apps.googleusercontent.com'; // Remplace par ton ID client
    const API_KEY = 'AIzaSyCFIShJe5FjUrK00QAq7zGxHhXLuTbKxZA'; // Remplace par ta clé API
    const FOLDER_ID = '11n9RVF-ZjTBOLMvoYB7asAs4A8hUfeYu'; // Remplace par l'ID de ton dossier Google Drive
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';

    let authToken = null;

    // Fonction appelée lors du retour de la connexion via Google Identity Services
    function handleCredentialResponse(response) {
      console.log("ID Token: " + response.credential);
      authToken = response.credential;
      listFiles();
    }

    // Fonction pour lister les fichiers audio depuis Google Drive
    function listFiles() {
      gapi.client.drive.files.list({
        q: `'${FOLDER_ID}' in parents and mimeType contains 'audio' and trashed = false`,
        fields: 'files(id, name, mimeType)',
        headers: {
          Authorization: `Bearer ${authToken}`
        }
      }).then(response => {
        const files = response.result.files;
        const audioListContainer = document.getElementById('audio-list');
        
        if (!files || files.length === 0) {
          audioListContainer.innerHTML = 'Aucun fichier trouvé.';
          return;
        }

        files.forEach(file => {
          const container = document.createElement('div');
          container.innerHTML = `
            <h3>${file.name}</h3>
            <audio controls>
              <source src="https://www.googleapis.com/drive/v3/files/${file.id}?alt=media&key=${API_KEY}" type="${file.mimeType}">
              Votre navigateur ne supporte pas l'audio.
            </audio>
          `;
          audioListContainer.appendChild(container);
        });
      }, err => {
        console.error('Erreur API:', err);
      });
    }

    // Fonction de chargement du client Google API
    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    // Initialisation du client Google API avec la clé API
    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        scope: SCOPES
      }).then(() => {
        console.log('API init');
      });
    }

    // Chargement du client Google API
    document.addEventListener('DOMContentLoaded', function () {
      handleClientLoad();
    });
  </script>
</body>
</html>
