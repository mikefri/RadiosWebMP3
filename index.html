<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Lecteur audio Drive</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://apis.google.com; style-src 'self'; img-src 'self' https://lh3.googleusercontent.com;">
</head>
<body>
  <h1>Lecteur audio depuis Google Drive</h1>
  <button onclick="handleAuthClick()">Se connecter</button>
  <div id="audio-list"></div>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = '702949477364-khje9k7kp6o2maappfucllp3u6va77vt.apps.googleusercontent.com'; // à remplacer si besoin
    const API_KEY = 'AIzaSyCFIShJe5FjUrK00QAq7zGxHhXLuTbKxZA';
    const FOLDER_ID = '11n9RVF-ZjTBOLMvoYB7asAs4A8hUfeYu';
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        scope: SCOPES
      }).then(() => {
        console.log('API init');
      });
    }

    function handleAuthClick() {
      gapi.auth2.getAuthInstance().signIn().then(() => {
        listFiles();
      });
    }

    function listFiles() {
      gapi.client.drive.files.list({
        q: `'${FOLDER_ID}' in parents and mimeType contains 'audio' and trashed = false`,
        fields: 'files(id, name, mimeType)'
      }).then(response => {
        const files = response.result.files;
        if (!files || files.length === 0) {
          document.getElementById('audio-list').innerText = 'Aucun fichier trouvé.';
          return;
        }

        files.forEach(file => {
          const container = document.createElement('div');
          container.innerHTML = `
            <h3>${file.name}</h3>
            <audio controls>
              <source src="https://www.googleapis.com/drive/v3/files/${file.id}?alt=media&key=${API_KEY}" type="${file.mimeType}">
              Votre navigateur ne supporte pas l'audio.
            </audio>
          `;
          document.getElementById('audio-list').appendChild(container);
        });
      }, err => {
        console.error('Erreur API:', err);
      });
    }

    handleClientLoad();
  </script>
</body>
</html>
